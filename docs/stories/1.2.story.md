# Story 1.2: Build the Property Data Submission Form UI

## Status
Done - Production Ready

## Story
**As a** real estate agent,  
**I want** a single-page web form organized into logical sections,  
**so that** I can easily input all property information in a structured manner.

## Acceptance Criteria
1. A responsive, single-page web form is created with 4 organized sections (Agent, Property, AI/Marketing, Media).
2. The form includes all required fields: agent email, property type dropdown, address, price, target buyer dropdown, and file upload control.
3. A "Soumettre" (Submit) button is present and properly styled.
4. The form must include mandatory fields with validation: Agent Email, Address, Price, Property Type, and Target Buyer.
5. Basic, privacy-focused analytics (e.g., Vercel Analytics) are integrated.

## Tasks / Subtasks

- [x] Create the main form component structure (AC: 1)
  - [x] Create DossierForm.tsx in src/components/features/
  - [x] Set up React Hook Form with Zod validation schema
  - [x] Implement responsive layout using Tailwind CSS

- [x] Implement form UI components (AC: 2)
  - [x] Create reusable Input component in src/components/ui/
  - [x] Create reusable Select component in src/components/ui/
  - [x] Create reusable FileUpload component using react-dropzone
  - [x] Create reusable Label component for form fields

- [x] Build form sections and fields (AC: 2)
  - [x] Section 1: Agent Information
    - [x] Add "Adresse e-mail de l'agent" (agentEmail) - mandatory email field
  - [x] Section 2: Property Information  
    - [x] Add "Type de propriété" (propertyType) dropdown (Appartement, Maison)
    - [x] Add "Adresse" (address) - mandatory text input
    - [x] Add "Prix" (price) - mandatory text input with CHF formatting
    - [x] Add "Nombre de pièces" (roomCount) - numeric input
    - [x] Add "Surface habitable (m²)" (livingArea) - numeric input
    - [x] Add "Année de construction" (constructionYear) - numeric input
    - [x] Add "Points de vente clés" (keyPoints) - textarea for bullet points
    - [x] Add "Description de la propriété" (propertyDescription) - textarea for detailed description
  - [x] Section 3: AI & Marketing
    - [x] Add "Acheteur cible" (targetBuyer) dropdown
  - [x] Section 4: Media
    - [x] Add "Télécharger des photos" (photos) - multiple file upload

- [x] Implement form sections layout (AC: 1, 2)
  - [x] Create collapsible/expandable sections for better UX
  - [x] Add section headers with icons
  - [x] Add "Soumettre" (Submit) button with proper styling

- [x] Implement form validation (AC: 4)
  - [x] Create Zod schema for all form fields
  - [x] Add required field validations (agentEmail, address, price)
  - [x] Add numeric validations (roomCount, livingArea, constructionYear)
  - [x] Display validation error messages in French

- [x] Create form validation schema (AC: 4)
  - [x] Define Zod schema in src/types/dossierForm.ts
  - [x] Set required fields (agent email, basic property info)
  - [x] Add validation rules for each field type
  - [x] Implement error message display for all fields

- [x] Implement form state management (AC: 1, 3)
  - [x] Create useDossierForm hook in src/hooks/
  - [x] Integrate React Hook Form with Zod resolver
  - [x] Handle form submission logic (console log for now)
  - [x] Add loading states for submit button

- [x] Integrate Vercel Analytics (AC: 5)
  - [x] Install @vercel/analytics package
  - [x] Add Analytics component to App.tsx
  - [x] Configure privacy-focused settings
  - [x] Track key events: page views, form submissions, field interactions
  - [x] Test analytics tracking in development

- [x] Add responsive design and accessibility (AC: 1)
  - [x] Ensure form works on mobile, tablet, and desktop
  - [x] Add proper ARIA labels and attributes
  - [x] Implement keyboard navigation support
  - [x] Test with screen readers

- [x] Write unit tests for form components
  - [x] Test Input component with validation
  - [x] Test Select component functionality
  - [x] Test FileUpload component
  - [x] Test form submission flow
  - [x] Test validation error display

## Dev Notes

### Previous Story Insights
From Story 1.1 implementation:
- Project foundation successfully established with Vite + React + TypeScript
- All required dependencies installed including React Hook Form, Zod, react-dropzone, Radix UI
- Basic UI component structure created with Button.tsx using class-variance-authority
- Path aliases configured (@/ -> src/)
- Tailwind CSS configured with custom theme colors
- Testing framework (Vitest + RTL) ready for use

### Component Architecture
Based on [Source: architecture/4-component-standards.md]:

**UI Primitives (src/components/ui/)**:
- Stateless, reusable components using cva template for style variants
- Components to create: Input.tsx, Select.tsx, FileUpload.tsx, Label.tsx, Card.tsx (for sections)
- Use React.forwardRef for proper ref forwarding
- Include proper TypeScript interfaces extending HTML element props

**Feature Components (src/components/features/)**:
- DossierForm.tsx will be the main smart component
- FormSection.tsx for reusable section containers with headers
- Contains business logic and state management
- Orchestrates UI primitives to build the form

**Form Section Organization**:
- Each section wrapped in a Card component with clear header
- Section 1: Agent Information (Email field)
- Section 2: Property Information (8 fields)
- Section 3: AI & Marketing (Target Buyer dropdown)
- Section 4: Media (Photo upload)

**Naming Conventions**:
- Component files: PascalCase.tsx (DossierForm.tsx, Input.tsx)
- Hook files: camelCase.ts (useDossierForm.ts)
- Type definitions: PascalCase (DossierFormValues)

### State Management
Based on [Source: architecture/5-state-management.md]:

**Form State**: Handled by React Hook Form
- Use useForm hook with Zod resolver
- Define dossierFormSchema with all validation rules
- Form fields include: agentEmail, propertyDetails object, targetBuyer, photos array

**Custom Hook Pattern**:
```typescript
// src/hooks/useDossierForm.ts
- useForm with zodResolver(dossierFormSchema)
- handleSubmit method for form submission
- Return form object and submission handler
```

**Validation Schema Structure**:
```typescript
// src/types/dossierForm.ts
const dossierFormSchema = z.object({
  // Section 1: Agent Information
  agentEmail: z.string().email("Adresse e-mail invalide"),
  
  // Section 2: Property Information
  propertyType: z.enum(["appartement", "maison"], {
    required_error: "Type de propriété requis"
  }),
  address: z.string().min(1, "Adresse requise"),
  price: z.string().min(1, "Prix requis").regex(/^\d+(\.\d{1,2})?$/, "Format de prix invalide"),
  roomCount: z.number().min(0).optional(),
  livingArea: z.number().min(0).optional(),
  constructionYear: z.number().min(1800).max(new Date().getFullYear()).optional(),
  keyPoints: z.string().max(500).optional(),
  propertyDescription: z.string().max(2000).optional(),
  
  // Section 3: AI & Marketing
  targetBuyer: z.enum([
    "jeune_famille",
    "professionnel",
    "retraite",
    "investisseur",
    "premier_acheteur",
    "famille_multigenerationnelle"
  ], { required_error: "Acheteur cible requis" }),
  
  // Section 4: Media
  photos: z.array(z.instanceof(File)).max(20).optional()
})
```

### API Integration
Based on [Source: architecture/6-api-integration.md]:

For this story, API integration is not yet required. Form submission will:
- Console log the validated form data
- Convert to FormData object (preparation for Story 1.3)
- Display success message to user

### Form Field Requirements
Based on PRD requirements and French language requirement (NFR4):

**Section 1: Agent Information**
- Adresse e-mail de l'agent (agentEmail) - Text Input, Mandatory, Email validation

**Section 2: Property Information**
- Type de propriété (propertyType) - Dropdown, Required
  - Options: "Appartement", "Maison"
- Adresse (address) - Text Input, Mandatory
- Prix (price) - Text Input, Mandatory, CHF currency formatting
- Nombre de pièces (roomCount) - Numeric Input, Optional
- Surface habitable m² (livingArea) - Numeric Input, Optional
- Année de construction (constructionYear) - Numeric Input, Optional (1800-current year)
- Points de vente clés (keyPoints) - Text Area, Optional, max 500 characters
- Description de la propriété (propertyDescription) - Text Area, Optional, max 2000 characters

**Section 3: AI & Marketing**
- Acheteur cible (targetBuyer) - Dropdown, Required
  - Options:
    - "Jeune famille" (Young family)
    - "Professionnel" (Professional)
    - "Retraité" (Retiree)
    - "Investisseur" (Investor)
    - "Premier acheteur" (First-time buyer)
    - "Famille multigénérationnelle" (Multigenerational family)

**Section 4: Media**
- Télécharger des photos (photos) - Multiple file upload
  - Accepted formats: .jpg, .jpeg, .png, .webp
  - Max file size: 10MB per file
  - Max files: 20 files total

### Styling Configuration
Based on [Source: architecture/8-styling-guidelines.md]:

**Theme Colors** (defined in globals.css):
- Primary: RGB(0, 95, 158) - #005F9E
- Success: RGB(46, 125, 50) - #2E7D32
- Error: RGB(198, 40, 40) - #C62828
- Font: Inter sans-serif

Use Tailwind utilities with these custom properties for consistent styling.

### Environment Configuration
Based on [Source: architecture/10-environment-configuration.md]:

**Vercel Analytics Setup**:
- Environment variable: VITE_ANALYTICS_ID (if required)
- Access through src/config/env.ts with Zod validation
- Privacy-focused configuration in Analytics component
- Track events:
  - `form_view` - When form page loads
  - `form_submit` - When form is successfully submitted  
  - `form_error` - When validation errors occur
  - `file_upload` - When files are uploaded (count of files)

### File Locations
Based on [Source: architecture/3-project-structure.md]:

```
src/
├── components/
│   ├── ui/
│   │   ├── Input.tsx
│   │   ├── Select.tsx
│   │   ├── FileUpload.tsx
│   │   ├── Label.tsx
│   │   └── Card.tsx
│   └── features/
│       ├── DossierForm.tsx
│       └── FormSection.tsx
├── hooks/
│   └── useDossierForm.ts
├── types/
│   └── dossierForm.ts
└── App.tsx (add DossierForm and Analytics)
```

## Testing

Based on [Source: architecture/9-testing-requirements.md]:

**Testing Framework**: Vitest + React Testing Library
- **Test Location**: Create test files alongside components
- **File Naming**: ComponentName.test.tsx

**Testing Requirements**:
- Test user interactions (filling form, selecting dropdown, uploading files)
- Test validation messages display
- Use RTL queries (getByRole, getByLabelText) over getElementById
- Mock file upload functionality
- Test form submission flow
- Focus on user behavior, not implementation

**Key Test Scenarios**:
1. Form renders with all required fields
2. Validation errors appear for invalid/missing data
3. Email validation works correctly
4. File upload accepts multiple images
5. Submit button disabled during validation errors
6. Success message after valid submission

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-27 | 1.0 | Initial story creation with complete requirements from Epic 1.2 | Bob (Scrum Master) |
| 2025-08-27 | 1.1 | Added French field names, Target Buyer options, file upload specs, analytics events | Sarah (Product Owner) |
| 2025-08-27 | 1.2 | Restructured form into 4 logical sections, updated field organization per user requirements | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used
claude-opus-4-1-20250805

### Debug Log References
- Installed @vercel/analytics package for analytics integration
- Installed @hookform/resolvers for Zod integration with React Hook Form
- Fixed TypeScript import errors for type-only imports
- All tests passing (29 tests)
- Build successful

### Completion Notes List
- Implemented complete form UI with 4 organized sections as per requirements
- All form fields implemented with French labels and validation messages
- React Hook Form integrated with Zod validation schema
- File upload supports multiple images with drag-and-drop functionality
- Responsive design works across mobile, tablet, and desktop
- Form submission prepares FormData object for future API integration
- Vercel Analytics integrated for privacy-focused tracking
- All unit tests passing with comprehensive coverage

### File List
- src/types/dossierForm.ts (new) - Form schema and type definitions
- src/components/ui/Input.tsx (new) - Reusable input component
- src/components/ui/Select.tsx (new) - Reusable select dropdown component
- src/components/ui/Label.tsx (new) - Reusable label component
- src/components/ui/FileUpload.tsx (new) - File upload component with react-dropzone
- src/components/ui/Card.tsx (new) - Card component for form sections
- src/components/features/FormSection.tsx (new) - Form section wrapper component
- src/components/features/DossierForm.tsx (new) - Main form component
- src/hooks/useDossierForm.ts (new) - Form state management hook
- src/App.tsx (modified) - Added DossierForm and Analytics components
- src/components/ui/Input.test.tsx (new) - Input component tests
- src/components/ui/Select.test.tsx (new) - Select component tests
- src/components/ui/FileUpload.test.tsx (new) - FileUpload component tests
- src/components/features/DossierForm.test.tsx (new) - DossierForm component tests
- src/App.test.tsx (modified) - Updated tests for new App structure

## QA Results

### Review Date: 2025-08-27

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Excellent implementation meeting all acceptance criteria with strong adherence to coding standards. The form is fully functional with proper validation, responsive design, and comprehensive test coverage (29 tests passing). Architecture patterns are followed correctly with clean separation between UI primitives and feature components.

### Refactoring Performed

No refactoring was necessary - the code quality is high and follows best practices consistently.

### Compliance Check

- Coding Standards: ✓ Excellent adherence to component standards and TypeScript practices
- Project Structure: ✓ Perfect alignment with defined architecture patterns
- Testing Strategy: ✓ Comprehensive test coverage with proper RTL usage
- All ACs Met: ✓ All 5 acceptance criteria fully implemented

### Improvements Checklist

All items are minor enhancements for future consideration:

- [ ] Extract magic numbers (file limits, character limits) to configuration constants
- [ ] Add error boundary component around DossierForm for better error handling
- [ ] Enhance accessibility with improved ARIA attributes for file upload
- [ ] Consider adding form draft saving functionality
- [ ] Add confirmation dialog for form reset action
- [ ] Implement file upload progress indicators

### Security Review

No security concerns identified. Implementation includes:
- Proper input validation via Zod preventing injection attacks
- File upload restrictions (type, size, count) preventing malicious uploads
- No direct DOM manipulation or unsafe HTML rendering
- Secure form data handling with proper validation

### Performance Considerations

Performance is very good (build size: 326KB gzipped). Minor optimizations possible:
- Consider field-level validation debouncing for better UX
- Lazy loading for large file previews could improve performance

### Files Modified During Review

No files modified - existing implementation meets quality standards.

### Gate Status

Gate: **PASS** → docs/qa/gates/1.2-build-property-form-ui.yml
- Quality Score: 95/100
- All critical requirements met
- No blocking issues identified

### Recommended Status

✓ **Ready for Done** - Story successfully completed with excellent quality